<div class = "col-lg-12 col-md-12 col-sm-12 col-xs-12 panelLeft animate__animated animate__fadeInLeft">
  <div class = "panelsWithOutMinHeight">
    <div class = "titleCards">
      <span><i class = "fas fa-sitemap"></i></span> Bitácora
    </div>
    <div class = "row justify-content-center">
      <div class = "col-xl-2 col-lg-6 col-sm-12">
        <div class = "mb-4 relative">
          <label class = "text-secondary"
                 style = "display:block">Teléfono</label>
          <input
            #telephone
            (change) = "getIssues(initDate.value,endDate.value, telephone.value)"
            class = "form-control inputClass datetimepicker"
            maxlength = "12"
            name = "telephone"
            placeholder = "Teléfono"
            type = "number"
            value = ""
          >
        </div>
      </div>
      <div class = "col-xl-2 col-lg-6 col-sm-12">
        <div class = "mb-4 relative">
          <label class = "text-secondary"
                 style = "display:block">Fecha de inicio</label>
          <input #initDate
                 (change) = "getIssues(initDate.value,endDate.value, telephone.value)"
                 [value] = "fechaActual"
                 class = "form-control inputClass datetimepicker"
                 for = "initDate"
                 max = "{{nowDateTime | date: 'yyyy-MM-dd'}}"
                 name = "initDate"
                 placeholder = "Fecha/Hora de entrada"
                 type = "Date"
          >
        </div>
      </div>
      <div class = "col-xl-2 col-lg-6 col-sm-12">
        <div class = "mb-4 relative">
          <label class = "text-secondary"
                 style = "display:block">Fecha de fin</label>
          <input
            #endDate
            (change) = "getIssues(initDate.value,endDate.value, telephone.value)"
            [value] = "fechaActual"
            class = "form-control inputClass datetimepicker"
            for = "endDate"
            max = "{{nowDateTime | date: 'yyyy-MM-dd'}}"
            name = "endDate"
            placeholder = "Fecha/Hora de salida"
            type = "date"
          >
        </div>
      </div>

    </div>
  </div>
</div>

<div class = 'row' *ngIf="issues.length > 0">
  <div class = "col-lg-12">
    <div class = "panelsWithOutMinHeight pb-4">
      <div class = "titleTicket">
        Información del usuario
      </div>
      <div class = "row mt-2">
        <div class = "col-4 mt-2 mb-2"><b>Nombre:</b></div>
        <div class = "col-8 mt-2 mb-2"><h6>{{this.issues[0]?.name}}</h6></div>
      </div>
      <div class = "row mt-2">
        <div class = "col-4 mt-2 mb-2"><b>Número de teléfono:</b></div>
        <div class = "col-8 mt-2 mb-2"><h6>{{this.issues[0]?.phone_number}}</h6></div>
      </div>
      <div class = "row">
        <div class = "col-4 mt-2 mb-2"><b>Módelo del teléfono:</b></div>
        <div class = "col-8 mt-2 mb-2"><h6>{{this.issues[0]?.userDevice}}</h6></div>
      </div>
    </div>
  </div>
</div>

<div class = "panels animate__animated animate__fadeInLeft">
  <div class = "titleCards">
    <span><em class = "fas fa-users"></em></span> Filtro de Bitácora
  </div>

  <table [dtOptions] = "dtOptions"
         [dtTrigger] = "dtTrigger"
         aria-label = "Log de incidencias"
         class = "table table-striped"
         datatable>
    <thead>
    <tr>
      <th scope = "col">Fecha</th>
      <th scope = "col">Mensaje</th>
      <th scope = "col">Mensaje Auxiliar</th>
      <th scope = "col">Estación</th>
      <th scope = "col">Parqueo</th>
      <th scope = "col">Nivel</th>
      <th scope = 'col'>Opciones</th>
    </tr>
    </thead>
    <tbody>
    <tr *ngFor = 'let issue of issues'
        class = 'animate__animated animate__fadeIn'>
      <td> {{issue.created_at}}</td>
      <td>{{issue.message}}</td>
      <td>{{issue.aux_msg}}</td>
      <td> {{issue.station_name}}</td>
      <td> {{issue.parking_name}}</td>

      <td style = 'position: relative'>
        <div style = 'display: inline-block'>{{issue.level}}</div>
        <div [ngClass] = "issue.level < 4 ? 'typeIssue lowstatus' : 'typeIssue highstatus'"></div>
      </td>
      <td>
        <button
          (click) = 'openContext(issue.context,contenido)'
          class = 'btn-input'
          title = 'Context'><em class = 'fas fa-eye'> Ver</em>
        </button>
      </td>
    </tr>
    </tbody>
  </table>


</div>

<ng-template #contenido
             let-modal>

  <div class = 'modal-header'>
    <h5 class = 'modal-title'>Log Capturado</h5>
    <button (click) = 'this.modal.close()'
            aria-label = 'Close'
            class = 'btn-close'
            type = 'button'></button>
  </div>
  <div class = 'modal-body'>
    <div class = 'list-group'>
      <textarea [value] = 'valContext'
                readonly
                rows = '5'></textarea>
    </div>
  </div>
  <hr>
  <div class = 'text-center'>
    <button
      (click) = 'this.modal.close()'
      class = 'btn btn-secondary'
      data-bs-dismiss = 'modal'
      type = 'button'>Cerrar
    </button>
  </div>

</ng-template>
